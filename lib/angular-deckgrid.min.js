/*! angular-deckgrid (v0.5.0) - Copyright: 2013 - 2014, André König (andre.koenig@posteo.de) - MIT */
/*
 * angular-deckgrid
 *
 * Copyright(c) 2013-2014 André König <andre.koenig@posteo.de>
 * MIT Licensed
 *
 */

/**
 * @author André König (andre.koenig@posteo.de)
 *
 */'use strict';angular.module("akoenig.deckgrid",[]);angular.module("akoenig.deckgrid").directive("deckgrid",["DeckgridDescriptor",function(e){return e.create()}]);angular.module("akoenig.deckgrid").factory("DeckgridDescriptor",["Deckgrid","$templateCache",function(e,h){function d(){this.restrict="AE";this.template='\x3cdiv data-ng-repeat\x3d"column in columns" class\x3d"{{layout.classList}}"\x3e\x3cdiv data-ng-repeat\x3d"card in column" data-ng-include\x3d"cardTemplate"\x3e\x3c/div\x3e\x3c/div\x3e';this.scope={model:"\x3dsource"};this.$$deckgrid=null;this.transclude=!0;this.link=this.$$link.bind(this);this.$$templateKeyIndex=0}d.prototype.$$destroy=function(){this.$$deckgrid.destroy()};d.prototype.$$link=function(a,c,b,d,g){var f="deckgrid/innerHtmlTemplate"+ ++this.$$templateKeyIndex+".html";a.$on("$destroy",this.$$destroy.bind(this));angular.isUndefined(b.cardtemplate)?(angular.isUndefined(b.cardtemplatestring)?g(a,function(a){var c=[],b=0,d=a.length,g;for(b;b<d;b+=1)g=a[b].outerHTML,angular.isDefined(g)&&c.push(g);h.put(f,c.join())}):h.put(f,c.attr("cardtemplatestring")),a.cardTemplate=f):a.cardTemplate=b.cardtemplate;a.mother=a.$parent;this.$$deckgrid=e.create(a,c[0])};return{create:function(){return new d}}}]);angular.module("akoenig.deckgrid").factory("Deckgrid",["$window","$log",function(e,h){function d(a,c){var b=this;this.$$elem=c;this.$$watchers=[];this.$$scope=a;this.$$scope.columns=[];this.$$scope.layout=this.$$getLayout();this.$$createColumns();a=this.$$scope.$watchCollection("model",this.$$onModelChange.bind(this));this.$$watchers.push(a);angular.forEach(b.$$getMediaQueries(),function(a){var c=b.$$onMediaQueryChange.bind(b);a.addListener(c);b.$$watchers.push(function(){a.removeListener(c)})});e.matchMedia("(orientation: portrait)").addListener(b.$$onMediaQueryChange.bind(b))}d.prototype.$$getMediaQueries=function(){var a=[],c=[],a=Array.prototype.concat.call(Array.prototype.slice.call(document.querySelectorAll("style[type\x3d'text/css']")),Array.prototype.slice.call(document.querySelectorAll("link[rel\x3d'stylesheet']")));angular.forEach(a,function(a){var b;try{b=a.sheet.cssRules||[]}catch(g){b=[]}angular.forEach(b,function(a){var b;a:{b=/\[(\w*-)?deckgrid\]::?before/g;var d,f;if(a.media&&!angular.isUndefined(a.cssRules))for(d=a.cssRules.length-1,d;0<=d;--d)if(f=a.cssRules[d].selectorText,angular.isDefined(f)&&f.match(b)){b=!0;break a}b=!1}b&&c.push(e.matchMedia(a.media.mediaText))})});return c};d.prototype.$$createColumns=function(){var a=this;if(!this.$$scope.layout)return console.log("angular-deckgrid: No CSS configuration found");this.$$scope.columns=[];angular.forEach(this.$$scope.model,function(c,b){var d=b%a.$$scope.layout.columns|0;a.$$scope.columns[d]||(a.$$scope.columns[d]=[]);c.$index=b;a.$$scope.columns[d].push(c)})};d.prototype.$$getLayout=function(){var a=e.getComputedStyle(this.$$elem,":before").content,c;if(null==a||void 0==a||""==a)a="classDeckGrid 300";console.log("getComputedStyle content:",a);if(void 0!=a&&""!=a){var a=a.replace(/'/g,""),a=a.replace(/"/g,""),b=a.split(" ");null!=b&&0<b.length&&(a=b[0],b=parseInt(b[1]),a=$("#"+a).width(),b=Math.floor(a/b),a=b+" .column.size-1-"+b)}a&&(a=a.replace(/'/g,""),a=a.replace(/"/g,""),a=a.split(" "),2===a.length&&(c={},c.columns=a[0]|0,c.classList=a[1].replace(/\./g," ").trim()));return c};d.prototype.$$onMediaQueryChange=function(){var a=this,c=this.$$getLayout();console.log("$$onMediaQueryChange");void 0!=c&&void 0!=c.columns&&void 0!=this.$$scope.layout.columns&&c.columns!==this.$$scope.layout.columns&&(a.$$scope.layout=c,a.$$scope.$apply(function(){a.$$createColumns()}))};d.prototype.$$onModelChange=function(a,c){a=a||[];c=c||[];angular.equals(c,a)||this.$$createColumns()};d.prototype.destroy=function(){var a=this.$$watchers.length-1;for(a;0<=a;--a)this.$$watchers[a]()};return{create:function(a,c){return new d(a,c)}}}]);
/*# sourceMappingURL=angular-deckgrid.min.js.map */