'use strict';(function(d,a){"function"===typeof define&&define.amd?define("wavesurfer",[],function(){return d.WaveSurfer=a()}):"object"===typeof exports?module.exports=a():d.WaveSurfer=a()})(this,function(){var d={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,skipLength:2,minPxPerSec:20,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,fillParent:!0,scrollParent:!1,hideScrollbar:!1,normalize:!1,audioContext:null,container:null,dragSelection:!0,loopSelection:!0,audioRate:1,interact:!0,splitChannels:!1,mediaContainer:null,mediaControls:!1,renderer:"MultiCanvas",backend:"WebAudio",mediaType:"audio",autoCenter:!0,partialRender:!1,minWaveformWidth:0},init:function(a){this.params=d.util.extend({},this.defaultParams,a);this.container="string"==typeof a.container?document.querySelector(this.params.container):this.params.container;if(!this.container)throw Error("Container element not found");this.mediaContainer=null==this.params.mediaContainer?this.container:"string"==typeof this.params.mediaContainer?document.querySelector(this.params.mediaContainer):this.params.mediaContainer;if(!this.mediaContainer)throw Error("Media Container element not found");this.savedVolume=0;this.isMuted=!1;this.tmpEvents=[];this.currentAjax=null;this.createDrawer();this.createBackend();this.createPeakCache();this.isDestroyed=!1},createDrawer:function(){var a=this;this.drawer=Object.create(d.Drawer[this.params.renderer]);this.drawer.init(this.container,this.params);this.drawer.on("redraw",function(){a.drawBuffer();a.drawer.progress(a.backend.getPlayedPercents())});this.drawer.on("click",function(b,c){setTimeout(function(){a.seekTo(c)},0)});this.drawer.on("scroll",function(b){a.params.partialRender&&a.drawBuffer();a.fireEvent("scroll",b)})},createBackend:function(){var a=this;this.backend&&this.backend.destroy();"AudioElement"==this.params.backend&&(this.params.backend="MediaElement");"WebAudio"!=this.params.backend||d.WebAudio.supportsWebAudio()||(this.params.backend="MediaElement");this.backend=Object.create(d[this.params.backend]);this.backend.init(this.params);this.backend.on("finish",function(){a.fireEvent("finish")});this.backend.on("play",function(){a.fireEvent("play")});this.backend.on("pause",function(){a.fireEvent("pause")});this.backend.on("audioprocess",function(b){a.drawer.progress(a.backend.getPlayedPercents());a.fireEvent("audioprocess",b)})},createPeakCache:function(){this.params.partialRender&&(this.peakCache=Object.create(d.PeakCache),this.peakCache.init())},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(a,b){this.fireEvent("interaction",this.play.bind(this,a,b));this.backend.play(a,b)},pause:function(){this.backend.isPaused()||this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},isPlaying:function(){return!this.backend.isPaused()},skipBackward:function(a){this.skip(-a||-this.params.skipLength)},skipForward:function(a){this.skip(a||this.params.skipLength)},skip:function(a){var b=this.getCurrentTime()||0,c=this.getDuration()||1,b=Math.max(0,Math.min(c,b+(a||0)));this.seekAndCenter(b/c)},seekAndCenter:function(a){this.seekTo(a);this.drawer.recenter(a)},seekTo:function(a){this.fireEvent("interaction",this.seekTo.bind(this,a));var b=this.backend.isPaused();b||this.backend.pause();var c=this.params.scrollParent;this.params.scrollParent=!1;this.backend.seekTo(a*this.getDuration());this.drawer.progress(this.backend.getPlayedPercents());b||this.backend.play();this.params.scrollParent=c;this.fireEvent("seek",a)},stop:function(){this.pause();this.seekTo(0);this.drawer.progress(0)},setVolume:function(a){this.backend.setVolume(a)},getVolume:function(){return this.backend.getVolume()},setPlaybackRate:function(a){this.backend.setPlaybackRate(a)},getPlaybackRate:function(){return this.backend.getPlaybackRate()},toggleMute:function(){this.setMute(!this.isMuted)},setMute:function(a){a!==this.isMuted&&(a?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0):(this.backend.setVolume(this.savedVolume),this.isMuted=!1))},getMute:function(){return this.isMuted},getFilters:function(){return this.backend.filters||[]},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent;this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var a=this.getDuration(),b=Math.round(a*this.params.minPxPerSec*this.params.pixelRatio),c=this.drawer.getWidth(),a=b,f=this.drawer.getScrollX(),h=Math.min(f+c,a);this.params.fillParent&&(!this.params.scrollParent||b<c)&&(a=c,f=0,h=a);if(this.params.partialRender)for(b=this.peakCache.addRangeToPeakCache(a,f,h),c=0;c<b.length;c++){var e=this.backend.getPeaks(a,b[c][0],b[c][1]);this.drawer.drawPeaks(e,a,b[c][0],b[c][1])}else f=0,h=a,e=this.backend.getPeaks(a,f,h),this.drawer.drawPeaks(e,a,f,h);this.fireEvent("redraw",e,a)},zoom:function(a){this.params.minPxPerSec=a;this.params.scrollParent=!0;this.drawBuffer();this.drawer.progress(this.backend.getPlayedPercents());this.drawer.recenter(this.getCurrentTime()/this.getDuration());this.fireEvent("zoom",a)},loadArrayBuffer:function(a){this.decodeArrayBuffer(a,function(a){this.isDestroyed||this.loadDecodedBuffer(a)}.bind(this))},loadDecodedBuffer:function(a){this.backend.load(a);this.drawBuffer();this.fireEvent("ready")},loadBlob:function(a){var b=this,c=new FileReader;c.addEventListener("progress",function(a){b.onProgress(a)});c.addEventListener("load",function(a){b.loadArrayBuffer(a.target.result)});c.addEventListener("error",function(){b.fireEvent("error","Error reading file")});c.readAsArrayBuffer(a);this.empty()},load:function(a,b,c){this.empty();switch(this.params.backend){case "WebAudio":return this.loadBuffer(a,b);case "MediaElement":return this.loadMediaElement(a,b,c)}},loadBuffer:function(a,b){var c=function(b){b&&this.tmpEvents.push(this.once("ready",b));return this.getArrayBuffer(a,this.loadArrayBuffer.bind(this))}.bind(this);if(b)this.backend.setPeaks(b),this.drawBuffer(),this.tmpEvents.push(this.once("interaction",c));else return c()},loadMediaElement:function(a,b,c){var f=a;"string"===typeof a?this.backend.load(f,this.mediaContainer,b,c):(this.backend.loadElt(a,b),f=a.src);this.tmpEvents.push(this.backend.once("canplay",function(){this.drawBuffer();this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(a){this.fireEvent("error",a)}.bind(this)));b?this.backend.setPeaks(b):this.backend.supportsWebAudio()&&this.getArrayBuffer(f,function(a){this.decodeArrayBuffer(a,function(a){this.backend.buffer=a;this.drawBuffer();this.fireEvent("waveform-ready")}.bind(this))}.bind(this))},decodeArrayBuffer:function(a,b){this.arraybuffer=a;this.backend.decodeArrayBuffer(a,function(c){this.isDestroyed||this.arraybuffer!=a||(b(c),this.arraybuffer=null)}.bind(this),this.fireEvent.bind(this,"error","Error decoding audiobuffer"))},getArrayBuffer:function(a,b){var c=this;this.currentAjax=a=d.util.ajax({url:a,responseType:"arraybuffer"});this.tmpEvents.push(a.on("progress",function(a){c.onProgress(a)}),a.on("success",function(a,h){b(a);c.currentAjax=null}),a.on("error",function(a){c.fireEvent("error","XHR error: "+a.target.statusText);c.currentAjax=null}));return a},onProgress:function(a){this.fireEvent("loading",Math.round(100*(a.lengthComputable?a.loaded/a.total:a.loaded/(a.loaded+1E6))),a.target)},exportPCM:function(a,b,c){b=b||1E4;c=c||!1;a=this.backend.getPeaks(a||1024,b);a=[].map.call(a,function(a){return Math.round(a*b)/b});a=JSON.stringify(a);c||window.open("data:application/json;charset\x3dutf-8,"+encodeURIComponent(a));return a},exportImage:function(a,b){a||(a="image/png");b||(b=1);return this.drawer.getImage(a,b)},cancelAjax:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)},clearTmpEvents:function(){this.tmpEvents.forEach(function(a){a.un()})},empty:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource());this.cancelAjax();this.clearTmpEvents();this.drawer.progress(0);this.drawer.setWidth(0);this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy");this.cancelAjax();this.clearTmpEvents();this.unAll();this.backend.destroy();this.drawer.destroy();this.isDestroyed=!0},create:function(a){var b=Object.create(d);b.init(a);return b},util:{extend:function(a){Array.prototype.slice.call(arguments,1).forEach(function(b){Object.keys(b).forEach(function(c){a[c]=b[c]})});return a},debounce:function(a,b,c){var f,h,e,g=function(){e=null;c||a.apply(h,f)};return function(){h=this;f=arguments;var d=c&&!e;clearTimeout(e);(e=setTimeout(g,b))||(e=setTimeout(g,b));d&&a.apply(h,f)}},min:function(a){var b=Infinity,c;for(c in a)a[c]<b&&(b=a[c]);return b},max:function(a){var b=-Infinity,c;for(c in a)a[c]>b&&(b=a[c]);return b},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(a){var b=Object.create(d.Observer),c=new XMLHttpRequest,f=!1;c.open(a.method||"GET",a.url,!0);c.responseType=a.responseType||"json";c.addEventListener("progress",function(a){b.fireEvent("progress",a);a.lengthComputable&&a.loaded==a.total&&(f=!0)});c.addEventListener("load",function(a){f||b.fireEvent("progress",a);b.fireEvent("load",a);200==c.status||206==c.status?b.fireEvent("success",c.response,a):b.fireEvent("error",a)});c.addEventListener("error",function(a){b.fireEvent("error",a)});c.send();b.xhr=c;return b}},Observer:{on:function(a,b){this.handlers||(this.handlers={});var c=this.handlers[a];c||(c=this.handlers[a]=[]);c.push(b);return{name:a,callback:b,un:this.un.bind(this,a,b)}},un:function(a,b){if(this.handlers&&(a=this.handlers[a]))if(b)for(var c=a.length-1;0<=c;c--)a[c]==b&&a.splice(c,1);else a.length=0},unAll:function(){this.handlers=null},once:function(a,b){var c=this,f=function(){b.apply(this,arguments);setTimeout(function(){c.un(a,f)},0)};return this.on(a,f)},fireEvent:function(a){if(this.handlers){var b=this.handlers[a],c=Array.prototype.slice.call(arguments,1);b&&b.forEach(function(a){a.apply(null,c)})}}}};d.util.extend(d,d.Observer);"use strict";d.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!(!window.AudioContext&&!window.webkitAudioContext)},getAudioContext:function(){this.ac||(this.ac=new (window.AudioContext||window.webkitAudioContext));return this.ac},getOfflineAudioContext:function(a){d.WebAudio.offlineAudioContext||(d.WebAudio.offlineAudioContext=new (window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,a));return d.WebAudio.offlineAudioContext},init:function(a){this.params=a;this.ac=a.audioContext||this.getAudioContext();this.lastPlay=this.ac.currentTime;this.startPosition=0;this.scheduledPause=null;this.states=[Object.create(d.WebAudio.state.playing),Object.create(d.WebAudio.state.paused),Object.create(d.WebAudio.state.finished)];this.createVolumeNode();this.createScriptNode();this.createAnalyserNode();this.setState(this.PAUSED_STATE);this.setPlaybackRate(this.params.audioRate);this.setLength(0)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(a){a&&a.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))},setState:function(a){this.state!==this.states[a]&&(this.state=this.states[a],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(a){this.disconnectFilters();a&&a.length&&(this.filters=a,this.analyser.disconnect(),a.reduce(function(a,c){a.connect(c);return c},this.analyser).connect(this.gainNode))},createScriptNode:function(){this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(this.scriptBufferSize):this.ac.createJavaScriptNode(this.scriptBufferSize);this.scriptNode.connect(this.ac.destination)},addOnAudioProcess:function(){var a=this;this.scriptNode.onaudioprocess=function(){var b=a.getCurrentTime();b>=a.getDuration()?(a.setState(a.FINISHED_STATE),a.fireEvent("pause")):b>=a.scheduledPause?a.pause():a.state===a.states[a.PLAYING_STATE]&&a.fireEvent("audioprocess",b)}},removeOnAudioProcess:function(){this.scriptNode.onaudioprocess=null},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser();this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode();this.gainNode.connect(this.ac.destination)},setVolume:function(a){this.gainNode.gain.value=a},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(a,b,c){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100));this.offlineAc.decodeAudioData(a,function(a){b(a)}.bind(this),c)},setPeaks:function(a){this.peaks=a},setLength:function(a){if(!this.mergedPeaks||a!=2*this.mergedPeaks.length-1+2){this.splitPeaks=[];this.mergedPeaks=[];for(var b=this.buffer?this.buffer.numberOfChannels:1,c=0;c<b;c++)this.splitPeaks[c]=[],this.splitPeaks[c][2*(a-1)]=0,this.splitPeaks[c][2*(a-1)+1]=0;this.mergedPeaks[2*(a-1)]=0;this.mergedPeaks[2*(a-1)+1]=0}},getPeaks:function(a,b,c){if(this.peaks)return this.peaks;this.setLength(a);a=this.buffer.length/a;for(var f=~~(a/10)||1,h=this.buffer.numberOfChannels,e=0;e<h;e++)for(var d=this.splitPeaks[e],l=this.buffer.getChannelData(e),k=b;k<=c;k++){for(var m=~~(k*a),n=~~(m+a),p=0,q=0;m<n;m+=f){var r=l[m];r>q&&(q=r);r<p&&(p=r)}d[2*k]=q;d[2*k+1]=p;if(0==e||q>this.mergedPeaks[2*k])this.mergedPeaks[2*k]=q;if(0==e||p<this.mergedPeaks[2*k+1])this.mergedPeaks[2*k+1]=p}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.isPaused()||this.pause();this.unAll();this.buffer=null;this.disconnectFilters();this.disconnectSource();this.gainNode.disconnect();this.scriptNode.disconnect();this.analyser.disconnect();this.params.audioContext||"undefined"!==typeof this.ac.close()&&"undefined"!=this.ac.state&&"closed"!=this.ac.state&&this.ac.close()},load:function(a){this.startPosition=0;this.lastPlay=this.ac.currentTime;this.buffer=a;this.createSource()},createSource:function(){this.disconnectSource();this.source=this.ac.createBufferSource();this.source.start=this.source.start||this.source.noteGrainOn;this.source.stop=this.source.stop||this.source.noteOff;this.source.playbackRate.value=this.playbackRate;this.source.buffer=this.buffer;this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return this.buffer?this.buffer.duration:0},seekTo:function(a,b){if(this.buffer)return this.scheduledPause=null,null==a&&(a=this.getCurrentTime(),a>=this.getDuration()&&(a=0)),null==b&&(b=this.getDuration()),this.startPosition=a,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:a,end:b}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(a,b){this.buffer&&(this.createSource(),b=this.seekTo(a,b),a=b.start,this.scheduledPause=b=b.end,this.source.start(0,a,b-a),"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState(this.PLAYING_STATE),this.fireEvent("play"))},pause:function(){this.scheduledPause=null;this.startPosition+=this.getPlayedTime();this.source&&this.source.stop(0);this.setState(this.PAUSED_STATE);this.fireEvent("pause")},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},getPlaybackRate:function(){return this.playbackRate},setPlaybackRate:function(a){a=a||1;this.isPaused()?this.playbackRate=a:(this.pause(),this.playbackRate=a,this.play())}};d.WebAudio.state={};d.WebAudio.state.playing={init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}};d.WebAudio.state.paused={init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},getCurrentTime:function(){return this.startPosition}};d.WebAudio.state.finished={init:function(){this.removeOnAudioProcess();this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}};d.util.extend(d.WebAudio,d.Observer);"use strict";d.MediaElement=Object.create(d.WebAudio);d.util.extend(d.MediaElement,{init:function(a){this.params=a;this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}};this.mediaType=a.mediaType.toLowerCase();this.elementPosition=a.elementPosition;this.setPlaybackRate(this.params.audioRate);this.createTimer()},createTimer:function(){var a=this,b=function(){a.isPaused()||(a.fireEvent("audioprocess",a.getCurrentTime()),(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(b))};this.on("play",b)},load:function(a,b,c,f){var d=document.createElement(this.mediaType);d.controls=this.params.mediaControls;d.autoplay=this.params.autoplay||!1;d.preload=null==f?"auto":f;d.src=a;d.style.width="100%";(a=b.querySelector(this.mediaType))&&b.removeChild(a);b.appendChild(d);this._load(d,c)},loadElt:function(a,b){a.controls=this.params.mediaControls;a.autoplay=this.params.autoplay||!1;this._load(a,b)},_load:function(a,b){var c=this;"function"==typeof a.load&&a.load();a.addEventListener("error",function(){c.fireEvent("error","Error loading media element")});a.addEventListener("canplay",function(){c.fireEvent("canplay")});a.addEventListener("ended",function(){c.fireEvent("finish")});this.media=a;this.peaks=b;this.buffer=this.onPlayEnd=null;this.setPlaybackRate(this.playbackRate)},isPaused:function(){return!this.media||this.media.paused},getDuration:function(){var a=(this.buffer||this.media).duration;Infinity<=a&&(a=this.media.seekable.end(0));return a},getCurrentTime:function(){return this.media&&this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},setPlaybackRate:function(a){this.playbackRate=a||1;this.media.playbackRate=this.playbackRate},seekTo:function(a){null!=a&&(this.media.currentTime=a);this.clearPlayEnd()},play:function(a,b){this.seekTo(a);this.media.play();b&&this.setPlayEnd(b);this.fireEvent("play")},pause:function(){this.media&&this.media.pause();this.clearPlayEnd();this.fireEvent("pause")},setPlayEnd:function(a){var b=this;this.onPlayEnd=function(c){c>=a&&(b.pause(),b.seekTo(a))};this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){this.onPlayEnd&&(this.un("audioprocess",this.onPlayEnd),this.onPlayEnd=null)},getPeaks:function(a,b,c){return this.buffer?d.WebAudio.getPeaks.call(this,a,b,c):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(a){this.media.volume=a},destroy:function(){this.pause();this.unAll();this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media);this.media=null}});d.AudioElement=d.MediaElement;"use strict";d.Drawer={init:function(a,b){this.container=a;this.params=b;this.width=0;this.height=b.height*this.params.pixelRatio;this.lastPos=0;this.initDrawer(b);this.createWrapper();this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave"));this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"});(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"});this.setupWrapperEvents()},handleEvent:function(a,b){!b&&a.preventDefault();a=a.targetTouches?a.targetTouches[0].clientX:a.clientX;b=this.wrapper.getBoundingClientRect();var c=this.width,f=this.getWidth();!this.params.fillParent&&c<f?(a=(a-b.left)*this.params.pixelRatio/c||0,1<a&&(a=1)):a=(a-b.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0;return a},setupWrapperEvents:function(){var a=this;this.wrapper.addEventListener("click",function(b){var c=a.wrapper.offsetHeight-a.wrapper.clientHeight;if(0!=c){var f=a.wrapper.getBoundingClientRect();if(b.clientY>=f.bottom-c)return}a.params.interact&&a.fireEvent("click",b,a.handleEvent(b))});this.wrapper.addEventListener("scroll",function(b){a.fireEvent("scroll",b)})},drawPeaks:function(a,b,c,f){this.setWidth(b);this.params.barWidth?this.drawBars(a,0,c,f):this.drawWave(a,0,c,f)},style:function(a,b){Object.keys(b).forEach(function(c){a.style[c]!==b[c]&&(a.style[c]=b[c])});return a},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(a){this.recenterOnPosition(this.wrapper.scrollWidth*a,!0)},recenterOnPosition:function(a,b){var c=this.wrapper.scrollLeft,f=~~(this.wrapper.clientWidth/2);a-=f;var d=a-c,e=this.wrapper.scrollWidth-this.wrapper.clientWidth;0!=e&&(!b&&-f<=d&&d<f&&(d=Math.max(-5,Math.min(5,d)),a=c+d),a=Math.max(0,Math.min(e,a)),a!=c&&(this.wrapper.scrollLeft=a))},getScrollX:function(){return Math.round(this.wrapper.scrollLeft*this.params.pixelRatio)},getWidth:function(){var a=this.container.clientWidth;0>=a&&this.params.minWaveformWidth&&(a=this.params.minWaveformWidth,console.log("wavesurfer drawer minWaveformWidth",a));return Math.round(a*this.params.pixelRatio)},setWidth:function(a){this.width!=a&&(this.width=a,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize())},setHeight:function(a){a!=this.height&&(this.height=a,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize())},progress:function(a){var b=1/this.params.pixelRatio,c=Math.round(a*this.width)*b;if(c<this.lastPos||c-this.lastPos>=b)this.lastPos=c,this.params.scrollParent&&this.params.autoCenter&&this.recenterOnPosition(~~(this.wrapper.scrollWidth*a)),this.updateProgress(c)},destroy:function(){this.unAll();this.wrapper&&(this.container.removeChild(this.wrapper),this.wrapper=null)},initDrawer:function(){},createElements:function(){},updateSize:function(){},drawWave:function(a,b){},clearWave:function(){},updateProgress:function(a){}};d.util.extend(d.Drawer,d.Observer);"use strict";d.Drawer.Canvas=Object.create(d.Drawer);d.util.extend(d.Drawer.Canvas,{createElements:function(){this.waveCc=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:0,top:0,bottom:0})).getContext("2d");this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor}));this.params.waveColor!=this.params.progressColor&&(this.progressCc=this.progressWave.appendChild(document.createElement("canvas")).getContext("2d"))},updateSize:function(){var a=Math.round(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width;this.waveCc.canvas.height=this.height;this.style(this.waveCc.canvas,{width:a+"px"});this.style(this.progressWave,{display:"block"});this.progressCc&&(this.progressCc.canvas.width=this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:a+"px"}));this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height);this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawBars:function(a,b,c,f){var h=this;if(a[0]instanceof Array){var e=a;if(this.params.splitChannels){this.setHeight(e.length*this.params.height*this.params.pixelRatio);e.forEach(function(a,b){h.drawBars(a,b,c,f)});return}a=e[0]}var g=1;[].some.call(a,function(a){return 0>a})&&(g=2);var l=.5/this.params.pixelRatio,e=this.width,k=this.params.height*this.params.pixelRatio,m=k*b||0,n=k/2;b=a.length/g;var p=this.params.barWidth*this.params.pixelRatio,q=p+Math.max(this.params.pixelRatio,~~(p/2)),r=1;if(this.params.normalize)var k=d.util.max(a),u=d.util.min(a),r=-u>k?-u:k;var t=b/e;this.waveCc.fillStyle=this.params.waveColor;this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor);[this.waveCc,this.progressCc].forEach(function(b){if(b)for(var e=c/t;e<f/t;e+=q){var d=Math.round((a[Math.floor(e*t*g)]||0)/r*n);b.fillRect(e+l,n-d+m,p+l,2*d)}},this)},drawWave:function(a,b,c,f){var h=this;if(a[0]instanceof Array){var e=a;if(this.params.splitChannels){this.setHeight(e.length*this.params.height*this.params.pixelRatio);e.forEach(function(a,b){h.drawWave(a,b,c,f)});return}a=e[0]}if(![].some.call(a,function(a){return 0>a})){for(var e=[],g=0,l=a.length;g<l;g++)e[2*g]=a[g],e[2*g+1]=-a[g];a=e}var k=.5/this.params.pixelRatio,e=this.params.height*this.params.pixelRatio,m=e*b||0,n=e/2;b=~~(a.length/2);var p=1;this.params.fillParent&&this.width!=b&&(p=this.width/b);var q=1;this.params.normalize&&(b=d.util.max(a),e=d.util.min(a),q=-e>b?-e:b);this.waveCc.fillStyle=this.params.waveColor;this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor);[this.waveCc,this.progressCc].forEach(function(b){if(b){b.beginPath();b.moveTo(c*p+k,n+m);for(var e=c;e<f;e++){var d=Math.round(a[2*e]/q*n);b.lineTo(e*p+k,n-d+m)}for(e=f-1;e>=c;e--)d=Math.round(a[2*e+1]/q*n),b.lineTo(e*p+k,n-d+m);b.closePath();b.fill();b.fillRect(0,n+m-k,this.width,k)}},this)},updateProgress:function(a){this.style(this.progressWave,{width:a+"px"})},getImage:function(a,b){return this.waveCc.canvas.toDataURL(a,b)}});"use strict";d.Drawer.MultiCanvas=Object.create(d.Drawer);d.util.extend(d.Drawer.MultiCanvas,{initDrawer:function(a){this.maxCanvasWidth=null!=a.maxCanvasWidth?a.maxCanvasWidth:4E3;this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio);if(1>=this.maxCanvasWidth)throw"maxCanvasWidth must be greater than 1.";if(1==this.maxCanvasWidth%2)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor;this.halfPixel=.5/this.params.pixelRatio;this.canvases=[]},createElements:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor}));this.addCanvas()},updateSize:function(){for(var a=Math.ceil(Math.round(this.width/this.params.pixelRatio)/this.maxCanvasElementWidth);this.canvases.length<a;)this.addCanvas();for(;this.canvases.length>a;)this.removeCanvas();for(var b in this.canvases)a=this.maxCanvasWidth+2*Math.ceil(this.params.pixelRatio/2),b==this.canvases.length-1&&(a=this.width-this.maxCanvasWidth*(this.canvases.length-1)),this.updateDimensions(this.canvases[b],a,this.height),this.clearWaveForEntry(this.canvases[b])},addCanvas:function(){var a={},b=this.maxCanvasElementWidth*this.canvases.length;a.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:b+"px",top:0,bottom:0}));a.waveCtx=a.wave.getContext("2d");this.hasProgressCanvas&&(a.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:b+"px",top:0,bottom:0})),a.progressCtx=a.progress.getContext("2d"));this.canvases.push(a)},removeCanvas:function(){var a=this.canvases.pop();a.wave.parentElement.removeChild(a.wave);this.hasProgressCanvas&&a.progress.parentElement.removeChild(a.progress)},updateDimensions:function(a,b,c){var d=Math.round(b/this.params.pixelRatio),h=Math.round(this.width/this.params.pixelRatio);a.start=a.waveCtx.canvas.offsetLeft/h||0;a.end=a.start+d/h;a.waveCtx.canvas.width=b;a.waveCtx.canvas.height=c;this.style(a.waveCtx.canvas,{width:d+"px"});this.style(this.progressWave,{display:"block"});this.hasProgressCanvas&&(a.progressCtx.canvas.width=b,a.progressCtx.canvas.height=c,this.style(a.progressCtx.canvas,{width:d+"px"}))},clearWave:function(){for(var a in this.canvases)this.clearWaveForEntry(this.canvases[a])},clearWaveForEntry:function(a){a.waveCtx.clearRect(0,0,a.waveCtx.canvas.width,a.waveCtx.canvas.height);this.hasProgressCanvas&&a.progressCtx.clearRect(0,0,a.progressCtx.canvas.width,a.progressCtx.canvas.height)},drawBars:function(a,b,c,f){var h=this;if(a[0]instanceof Array){if(this.params.splitChannels){this.setHeight(a.length*this.params.height*this.params.pixelRatio);a.forEach(function(a,b){h.drawBars(a,b,c,f)});return}a=a[0]}var e=1;[].some.call(a,function(a){return 0>a})&&(e=2);var g=this.width,l=this.params.height*this.params.pixelRatio;b=l*b||0;var l=l/2,k=a.length/e,m=this.params.barWidth*this.params.pixelRatio,n=m+Math.max(this.params.pixelRatio,~~(m/2)),p=1;if(this.params.normalize)var p=d.util.max(a),q=d.util.min(a),p=-q>p?-q:p;g=k/g;for(k=c/g;k<f/g;k+=n)q=Math.round((a[Math.floor(k*g*e)]||0)/p*l),this.fillRect(k+this.halfPixel,l-q+b,m+this.halfPixel,2*q)},drawWave:function(a,b,c,f){var h=this;if(a[0]instanceof Array){if(this.params.splitChannels){this.setHeight(a.length*this.params.height*this.params.pixelRatio);a.forEach(function(a,b){h.drawWave(a,b,c,f)});return}a=a[0]}if(![].some.call(a,function(a){return 0>a})){for(var e=[],g=0,l=a.length;g<l;g++)e[2*g]=a[g],e[2*g+1]=-a[g];a=e}e=this.params.height*this.params.pixelRatio;b=e*b||0;e/=2;g=1;this.params.normalize&&(g=d.util.max(a),l=d.util.min(a),g=-l>g?-l:g);this.drawLine(a,g,e,b,c,f);this.fillRect(0,e+b-this.halfPixel,this.width,this.halfPixel)},drawLine:function(a,b,c,d,h,e){for(var f in this.canvases){var l=this.canvases[f];this.setFillStyles(l);this.drawLineToContext(l,l.waveCtx,a,b,c,d,h,e);this.drawLineToContext(l,l.progressCtx,a,b,c,d,h,e)}},drawLineToContext:function(a,b,c,d,h,e,g,l){if(b){var f=c.length/2,m=1;this.params.fillParent&&this.width!=f&&(m=this.width/f);var n=Math.round(f*a.start);a=Math.round(f*a.end);if(!(n>l||a<g)){g=Math.max(n,g);l=Math.min(a,l);b.beginPath();b.moveTo((g-n)*m+this.halfPixel,h+e);for(a=g;a<l;a++)f=c[2*a]||0,f=Math.round(f/d*h),b.lineTo((a-n)*m+this.halfPixel,h-f+e);for(a=l-1;a>=g;a--)f=c[2*a+1]||0,f=Math.round(f/d*h),b.lineTo((a-n)*m+this.halfPixel,h-f+e);b.closePath();b.fill()}}},fillRect:function(a,b,c,d){for(var f=Math.min(Math.ceil((a+c)/this.maxCanvasWidth)+1,this.canvases.length),e=Math.floor(a/this.maxCanvasWidth);e<f;e++){var g=this.canvases[e],l=e*this.maxCanvasWidth,k=Math.max(a,e*this.maxCanvasWidth),m=b,n=Math.min(a+c,e*this.maxCanvasWidth+g.waveCtx.canvas.width),p=b+d;k<n&&(this.setFillStyles(g),this.fillRectToContext(g.waveCtx,k-l,m,n-k,p-m),this.fillRectToContext(g.progressCtx,k-l,m,n-k,p-m))}},fillRectToContext:function(a,b,c,d,h){a&&a.fillRect(b,c,d,h)},setFillStyles:function(a){a.waveCtx.fillStyle=this.params.waveColor;this.hasProgressCanvas&&(a.progressCtx.fillStyle=this.params.progressColor)},updateProgress:function(a){this.style(this.progressWave,{width:a+"px"})}});"use strict";d.PeakCache={init:function(){this.clearPeakCache()},clearPeakCache:function(){this.peakCacheRanges=[];this.peakCacheLength=-1},addRangeToPeakCache:function(a,b,c){a!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=a);a=[];for(var d=0;d<this.peakCacheRanges.length&&this.peakCacheRanges[d]<b;)d++;for(0==d%2&&a.push(b);d<this.peakCacheRanges.length&&this.peakCacheRanges[d]<=c;)a.push(this.peakCacheRanges[d]),d++;0==d%2&&a.push(c);a=a.filter(function(a,b,c){return 0==b?a!=c[b+1]:b==c.length-1?a!=c[b-1]:a!=c[b-1]&&a!=c[b+1]});this.peakCacheRanges=this.peakCacheRanges.concat(a);this.peakCacheRanges=this.peakCacheRanges.sort(function(a,b){return a-b}).filter(function(a,b,c){return 0==b?a!=c[b+1]:b==c.length-1?a!=c[b-1]:a!=c[b-1]&&a!=c[b+1]});b=[];for(d=0;d<a.length;d+=2)b.push([a[d],a[d+1]]);return b},getCacheRanges:function(){for(var a=[],b=0;b<this.peakCacheRanges.length;b+=2)a.push([this.peakCacheRanges[b],this.peakCacheRanges[b+1]]);return a}};"use strict";(function(){var a=function(){var a=document.querySelectorAll("wavesurfer");Array.prototype.forEach.call(a,function(a){var b=d.util.extend({container:a,backend:"MediaElement",mediaControls:!0},a.dataset);a.style.display="block";b=d.create(b);if(a.dataset.peaks)var c=JSON.parse(a.dataset.peaks);b.load(a.dataset.url,c)})};"complete"===document.readyState?a():window.addEventListener("load",a)})();return d});
/*# sourceMappingURL=wavesurfer.min.js.map */